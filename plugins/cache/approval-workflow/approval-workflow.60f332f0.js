!(function(t, e) { typeof exports === 'object' && typeof module === 'object' ? module.exports = e() : typeof define === 'function' && define.amd ? define([], e) : typeof exports === 'object' ? exports['WikiPlugin_approval-workflow'] = e() : t['WikiPlugin_approval-workflow'] = e() }(window, function() { return (function(t) { var e = {}; function n(r) { if (e[r]) return e[r].exports; var o = e[r] = {i: r, l: !1, exports: {}}; return t[r].call(o.exports, o, o.exports, n), o.l = !0, o.exports } return n.m = t, n.c = e, n.d = function(t, e, r) { n.o(t, e) || Object.defineProperty(t, e, {enumerable: !0, get: r}) }, n.r = function(t) { typeof Symbol !== 'undefined' && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {value: 'Module'}), Object.defineProperty(t, '__esModule', {value: !0}) }, n.t = function(t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && typeof t === 'object' && t && t.__esModule) return t; var r = Object.create(null); if (n.r(r), Object.defineProperty(r, 'default', {enumerable: !0, value: t}), 2 & e && typeof t !== 'string') for (var o in t)n.d(r, o, function(e) { return t[e] }.bind(null, o)); return r }, n.n = function(t) { var e = t && t.__esModule ? function() { return t.default } : function() { return t }; return n.d(e, 'a', e), e }, n.o = function(t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = '/plugins/assets/approval-workflow/', n(n.s = 2) }([function(t, e, n) {}, function(t, e, n) { 'use strict'; n(0) }, function(t, e, n) { 'use strict'; function r() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t; var e; var n = typeof Symbol === 'function' ? Symbol : {}; var a = n.iterator || '@@iterator'; var i = n.toStringTag || '@@toStringTag'; function s(n, r, a, i) { var s = r && r.prototype instanceof u ? r : u; var p = Object.create(s.prototype); return o(p, '_invoke', (function(n, r, o) { var a; var i; var s; var u = 0; var p = o || []; var l = !1; var f = {p: 0, n: 0, v: t, a: v, f: v.bind(t, 4), d: function(e, n) { return a = e, i = 0, s = t, f.n = n, c }}; function v(n, r) { for (i = n, s = r, e = 0; !l && u && !o && e < p.length; e++) { var o; var a = p[e]; var v = f.p; var d = a[2]; n > 3 ? (o = d === r) && (s = a[(i = a[4]) ? 5 : (i = 3, 3)], a[4] = a[5] = t) : a[0] <= v && ((o = n < 2 && v < a[1]) ? (i = 0, f.v = r, f.n = a[1]) : v < d && (o = n < 3 || a[0] > r || r > d) && (a[4] = n, a[5] = r, f.n = d, i = 0)) } if (o || n > 1) return c; throw l = !0, r } return function(o, p, d) { if (u > 1) throw TypeError('Generator is already running'); for (l && p === 1 && v(p, d), i = p, s = d; (e = i < 2 ? t : s) || !l;) { a || (i ? i < 3 ? (i > 1 && (f.n = -1), v(i, s)) : f.n = s : f.v = s); try { if (u = 2, a) { if (i || (o = 'next'), e = a[o]) { if (!(e = e.call(a, s))) throw TypeError('iterator result is not an object'); if (!e.done) return e; s = e.value, i < 2 && (i = 0) } else i === 1 && (e = a.return) && e.call(a), i < 2 && (s = TypeError("The iterator does not provide a '" + o + "' method"), i = 1); a = t } else if ((e = (l = f.n < 0) ? s : n.call(r, f)) !== c) break } catch (e) { a = t, i = 1, s = e } finally { u = 1 } } return {value: e, done: l} } }(n, a, i)), !0), p } var c = {}; function u() {} function p() {} function l() {}e = Object.getPrototypeOf; var f = [][a] ? e(e([][a]())) : (o(e = {}, a, function() { return this }), e); var v = l.prototype = u.prototype = Object.create(f); function d(t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, l) : (t.__proto__ = l, o(t, i, 'GeneratorFunction')), t.prototype = Object.create(v), t } return p.prototype = l, o(v, 'constructor', l), o(l, 'constructor', p), p.displayName = 'GeneratorFunction', o(l, i, 'GeneratorFunction'), o(v), o(v, i, 'Generator'), o(v, a, function() { return this }), o(v, 'toString', function() { return '[object Generator]' }), (r = function() { return {w: s, m: d} })() } function o(t, e, n, r) { var a = Object.defineProperty; try { a({}, '', {}) } catch (t) { a = 0 }(o = function(t, e, n, r) { function i(e, n) { o(t, e, function(t) { return this._invoke(e, n, t) }) }e ? a ? a(t, e, {value: n, enumerable: !r, configurable: !r, writable: !r}) : t[e] = n : (i('next', 0), i('throw', 1), i('return', 2)) })(t, e, n, r) } function a(t, e, n, r, o, a, i) { try { var s = t[a](i); var c = s.value } catch (t) { return void n(t) }s.done ? e(c) : Promise.resolve(c).then(r, o) } function i(t) { return function() { var e = this; var n = arguments; return new Promise(function(r, o) { var i = t.apply(e, n); function s(t) { a(i, r, o, s, c, 'next', t) } function c(t) { a(i, r, o, s, c, 'throw', t) }s(void 0) }) } }n.r(e), n.d(e, 'approvalStore', function() { return s }); var s = {namespaced: !0, state: {stats: {pending: 0, approved: 0, rejected: 0, total: 0}, approvals: [], loading: !1, lastFetched: null}, getters: {pendingCount: function(t) { return t.stats.pending }, approvedCount: function(t) { return t.stats.approved }, rejectedCount: function(t) { return t.stats.rejected }, totalCount: function(t) { return t.stats.total }, allApprovals: function(t) { return t.approvals }, isLoading: function(t) { return t.loading }, needsRefresh: function(t) { if (!t.lastFetched) return !0; return Date.now() - t.lastFetched > 3e5 }}, mutations: {SET_STATS: function(t, e) { t.stats = e }, SET_APPROVALS: function(t, e) { t.approvals = e }, SET_LOADING: function(t, e) { t.loading = e }, SET_LAST_FETCHED: function(t, e) { t.lastFetched = e }, UPDATE_APPROVAL: function(t, e) { var n = t.approvals.findIndex(function(t) { return t.id === e.id }); n >= 0 && t.approvals.splice(n, 1, e) }, REMOVE_APPROVAL: function(t, e) { t.approvals = t.approvals.filter(function(t) { return t.id !== e }) }}, actions: {fetchStats: function(t) { return i(r().m(function e() { var n, o, a, i; return r().w(function(e) { for (;;) switch (e.p = e.n) { case 0:return n = t.commit, e.p = 1, e.n = 2, fetch('/api/plugin/approval-workflow/stats'); case 2:return o = e.v, e.n = 3, o.json(); case 3:(a = e.v).stats && (n('SET_STATS', a.stats), n('SET_LAST_FETCHED', Date.now())), e.n = 5; break; case 4:e.p = 4, i = e.v, console.error('[Approval Store] Failed to fetch stats:', i); case 5:return e.a(2) } }, e, null, [[1, 4]]) }))() }, fetchApprovals: function(t) { var e = arguments; return i(r().m(function n() { var o, a, i, s, c, u, p, l, f, v, d; return r().w(function(n) { for (;;) switch (n.p = n.n) { case 0:return o = t.commit, a = e.length > 1 && void 0 !== e[1] ? e[1] : {}, i = a.status, s = a.limit, c = void 0 === s ? 50 : s, u = a.offset, p = void 0 === u ? 0 : u, n.p = 1, o('SET_LOADING', !0), l = '/api/plugin/approval-workflow/approvals?limit='.concat(c, '&offset=').concat(p), i && (l += '&status='.concat(i)), n.n = 2, fetch(l); case 2:return f = n.v, n.n = 3, f.json(); case 3:(v = n.v).approvals && (o('SET_APPROVALS', v.approvals), o('SET_LAST_FETCHED', Date.now())), n.n = 5; break; case 4:n.p = 4, d = n.v, console.error('[Approval Store] Failed to fetch approvals:', d); case 5:return n.p = 5, o('SET_LOADING', !1), n.f(5); case 6:return n.a(2) } }, n, null, [[1, 4, 5, 6]]) }))() }, approveRequest: function(t, e) { return i(r().m(function n() { var o, a, i, s, c, u, p; return r().w(function(n) { for (;;) switch (n.p = n.n) { case 0:return o = t.commit, a = t.dispatch, i = e.id, s = e.notes, n.p = 1, n.n = 2, fetch('/api/plugin/approval-workflow/approvals/'.concat(i, '/approve'), {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({notes: s})}); case 2:return c = n.v, n.n = 3, c.json(); case 3:if (!(u = n.v).success || !u.approval) { n.n = 5; break } return o('UPDATE_APPROVAL', u.approval), n.n = 4, a('fetchStats'); case 4:return n.a(2, {success: !0, approval: u.approval}); case 5:throw new Error(u.message || 'Failed to approve request'); case 6:n.n = 8; break; case 7:return n.p = 7, p = n.v, console.error('[Approval Store] Failed to approve:', p), n.a(2, {success: !1, error: p.message}); case 8:return n.a(2) } }, n, null, [[1, 7]]) }))() }, rejectRequest: function(t, e) { return i(r().m(function n() { var o, a, i, s, c, u, p; return r().w(function(n) { for (;;) switch (n.p = n.n) { case 0:return o = t.commit, a = t.dispatch, i = e.id, s = e.notes, n.p = 1, n.n = 2, fetch('/api/plugin/approval-workflow/approvals/'.concat(i, '/reject'), {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({notes: s})}); case 2:return c = n.v, n.n = 3, c.json(); case 3:if (!(u = n.v).success || !u.approval) { n.n = 5; break } return o('UPDATE_APPROVAL', u.approval), n.n = 4, a('fetchStats'); case 4:return n.a(2, {success: !0, approval: u.approval}); case 5:throw new Error(u.message || 'Failed to reject request'); case 6:n.n = 8; break; case 7:return n.p = 7, p = n.v, console.error('[Approval Store] Failed to reject:', p), n.a(2, {success: !1, error: p.message}); case 8:return n.a(2) } }, n, null, [[1, 7]]) }))() }}}; var c = function() { var t = this; var e = t.$createElement; var n = t._self._c || e; return n('div', [n('v-menu', {attrs: {'offset-y': '', bottom: '', left: '', 'min-width': '300'}, scopedSlots: t._u([{key: 'activator', fn: function(e) { var r = e.on; var o = e.attrs; return [n('v-btn', t._g(t._b({class: t.badgeClass, attrs: {icon: ''}}, 'v-btn', o, !1), r), [n('v-badge', {attrs: {content: t.pendingCount, value: t.pendingCount > 0, color: 'red', overlap: ''}}, [n('v-icon', {attrs: {color: 'grey'}}, [t._v('mdi-check-circle-outline')])], 1)], 1)] }}])}, [t._v(' '), n('v-list', {attrs: {nav: '', dense: ''}}, [n('v-list-item', {attrs: {'three-line': ''}}, [n('v-list-item-content', [n('v-list-item-title', {staticClass: 'font-weight-bold'}, [t._v('Approval Requests')]), t._v(' '), n('v-list-item-subtitle', [t._v(t._s(t.stats.pending) + ' pending')]), t._v(' '), n('v-list-item-subtitle', [t._v(t._s(t.stats.approved) + ' approved, ' + t._s(t.stats.rejected) + ' rejected')])], 1)], 1), t._v(' '), n('v-divider'), t._v(' '), t.stats.pending > 0 ? n('v-list-item', {attrs: {to: '/a/plugin/approval-workflow/approvals', color: 'primary'}}, [n('v-list-item-avatar', {attrs: {size: '24'}}, [n('v-icon', [t._v('mdi-clipboard-check-outline')])], 1), t._v(' '), n('v-list-item-content', [n('v-list-item-title', [t._v('View All Requests')])], 1)], 1) : n('v-list-item', {attrs: {disabled: ''}}, [n('v-list-item-content', [n('v-list-item-title', {staticClass: 'grey--text'}, [t._v('No pending requests')])], 1)], 1)], 1)], 1)], 1) }; function u() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t; var e; var n = typeof Symbol === 'function' ? Symbol : {}; var r = n.iterator || '@@iterator'; var o = n.toStringTag || '@@toStringTag'; function a(n, r, o, a) { var c = r && r.prototype instanceof s ? r : s; var u = Object.create(c.prototype); return p(u, '_invoke', (function(n, r, o) { var a; var s; var c; var u = 0; var p = o || []; var l = !1; var f = {p: 0, n: 0, v: t, a: v, f: v.bind(t, 4), d: function(e, n) { return a = e, s = 0, c = t, f.n = n, i }}; function v(n, r) { for (s = n, c = r, e = 0; !l && u && !o && e < p.length; e++) { var o; var a = p[e]; var v = f.p; var d = a[2]; n > 3 ? (o = d === r) && (c = a[(s = a[4]) ? 5 : (s = 3, 3)], a[4] = a[5] = t) : a[0] <= v && ((o = n < 2 && v < a[1]) ? (s = 0, f.v = r, f.n = a[1]) : v < d && (o = n < 3 || a[0] > r || r > d) && (a[4] = n, a[5] = r, f.n = d, s = 0)) } if (o || n > 1) return i; throw l = !0, r } return function(o, p, d) { if (u > 1) throw TypeError('Generator is already running'); for (l && p === 1 && v(p, d), s = p, c = d; (e = s < 2 ? t : c) || !l;) { a || (s ? s < 3 ? (s > 1 && (f.n = -1), v(s, c)) : f.n = c : f.v = c); try { if (u = 2, a) { if (s || (o = 'next'), e = a[o]) { if (!(e = e.call(a, c))) throw TypeError('iterator result is not an object'); if (!e.done) return e; c = e.value, s < 2 && (s = 0) } else s === 1 && (e = a.return) && e.call(a), s < 2 && (c = TypeError("The iterator does not provide a '" + o + "' method"), s = 1); a = t } else if ((e = (l = f.n < 0) ? c : n.call(r, f)) !== i) break } catch (e) { a = t, s = 1, c = e } finally { u = 1 } } return {value: e, done: l} } }(n, o, a)), !0), u } var i = {}; function s() {} function c() {} function l() {}e = Object.getPrototypeOf; var f = [][r] ? e(e([][r]())) : (p(e = {}, r, function() { return this }), e); var v = l.prototype = s.prototype = Object.create(f); function d(t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, l) : (t.__proto__ = l, p(t, o, 'GeneratorFunction')), t.prototype = Object.create(v), t } return c.prototype = l, p(v, 'constructor', l), p(l, 'constructor', c), c.displayName = 'GeneratorFunction', p(l, o, 'GeneratorFunction'), p(v), p(v, o, 'Generator'), p(v, r, function() { return this }), p(v, 'toString', function() { return '[object Generator]' }), (u = function() { return {w: a, m: d} })() } function p(t, e, n, r) { var o = Object.defineProperty; try { o({}, '', {}) } catch (t) { o = 0 }(p = function(t, e, n, r) { function a(e, n) { p(t, e, function(t) { return this._invoke(e, n, t) }) }e ? o ? o(t, e, {value: n, enumerable: !r, configurable: !r, writable: !r}) : t[e] = n : (a('next', 0), a('throw', 1), a('return', 2)) })(t, e, n, r) } function l(t, e, n, r, o, a, i) { try { var s = t[a](i); var c = s.value } catch (t) { return void n(t) }s.done ? e(c) : Promise.resolve(c).then(r, o) } function f(t) { return function() { var e = this; var n = arguments; return new Promise(function(r, o) { var a = t.apply(e, n); function i(t) { l(a, r, o, i, s, 'next', t) } function s(t) { l(a, r, o, i, s, 'throw', t) }i(void 0) }) } }c._withStripped = !0; var v = {name: 'ApprovalBadge', data: function() { return {stats: {pending: 0, approved: 0, rejected: 0, total: 0}, loading: !1} }, computed: {pendingCount: function() { return this.stats.pending }, badgeClass: function() { return this.pendingCount > 0 ? 'pulse' : '' }}, mounted: function() { var t = this; return f(u().m(function e() { return u().w(function(e) { for (;;) switch (e.n) { case 0:return e.n = 1, t.fetchStats(); case 1:t.statsInterval = setInterval(function() { t.fetchStats() }, 3e4); case 2:return e.a(2) } }, e) }))() }, beforeDestroy: function() { this.statsInterval && clearInterval(this.statsInterval) }, methods: {fetchStats: function() { var t = this; return f(u().m(function e() { var n, r, o; return u().w(function(e) { for (;;) switch (e.p = e.n) { case 0:return e.p = 0, t.loading = !0, e.n = 1, fetch('/api/plugin/approval-workflow/stats'); case 1:return n = e.v, e.n = 2, n.json(); case 2:(r = e.v).stats && (t.stats = r.stats), e.n = 4; break; case 3:e.p = 3, o = e.v, console.error('[ApprovalBadge] Failed to fetch stats:', o); case 4:return e.p = 4, t.loading = !1, e.f(4); case 5:return e.a(2) } }, e, null, [[0, 3, 4, 5]]) }))() }}}; n(1); var d = (function(t, e, n, r, o, a, i, s) { var c; var u = typeof t === 'function' ? t.options : t; if (e && (u.render = e, u.staticRenderFns = n, u._compiled = !0), r && (u.functional = !0), a && (u._scopeId = 'data-v-' + a), i ? (c = function(t) { (t = t || this.$vnode && this.$vnode.ssrContext || this.parent && this.parent.$vnode && this.parent.$vnode.ssrContext) || typeof __VUE_SSR_CONTEXT__ === 'undefined' || (t = __VUE_SSR_CONTEXT__), o && o.call(this, t), t && t._registeredComponents && t._registeredComponents.add(i) }, u._ssrRegister = c) : o && (c = s ? function() { o.call(this, (u.functional ? this.parent : this).$root.$options.shadowRoot) } : o), c) if (u.functional) { u._injectStyles = c; var p = u.render; u.render = function(t, e) { return c.call(e), p(t, e) } } else { var l = u.beforeCreate; u.beforeCreate = l ? [].concat(l, c) : [c] } return {exports: t, options: u} }(v, c, [], !1, null, '424a80ba', null)); d.options.__file = 'plugins/installed/approval-workflow/client/components/ApprovalBadge.vue'; var h = d.exports; typeof window !== 'undefined' && (window.WIKI_PLUGIN_STORES = window.WIKI_PLUGIN_STORES || {}, window.WIKI_PLUGIN_STORES['plugin_approval-workflow_approval'] = s); e.default = {install: function(t) { console.log('[Approval Workflow] Plugin installed'), t.component('PluginApprovalWorkflowApprovalBadge', h) }} }])) }))
